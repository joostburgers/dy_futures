---
title: "Digital Yoknapatawpha"
author: "Johannes Burgers"
subtitle: "Mapping the Past in the Future"
date: "2/2/2022"
output: 
  revealjs::revealjs_presentation:
    theme: serif
    self_contained: false
    reveal_plugins: ["menu"]
    reveal_options:
      menu:
        side: right
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
```{r load_chart_styling, echo=FALSE}
#Page styling

#This is where you create your own custom color palette for the traces.
faulkner_colorway = c("#132C53","#F27A18","#ae0700","#79b473","#38726c","#76bed0","#6b2d5c","#448b2d","#e6d812")

faulkner_colorway_highlight_1 = c(
  "rgba(19, 44, 83, 1)",
  "rgba(242, 122, 24,.1)",
  "rgba(174, 7, 0,.05)",
  "rgba(121, 180, 115,.1)",
  "rgba(56, 114, 108,.1)",
  "rgba(118, 190, 208,.1)"
)

faulkner_colorway_highlight_2 = c(
  "rgba(19, 44, 83, .1)",
  "rgba(242, 122, 24,1)",
  "rgba(174, 7, 0,.05)",
  "rgba(121, 180, 115,.1)",
  "rgba(56, 114, 108,.1)",
  "rgba(118, 190, 208,.1)"
)

faulkner_colorway_highlight_3 = c(
  "rgba(19, 44, 83, .1)",
  "rgba(242, 122, 24,.1)",
  "rgba(174, 7, 0,1)",
  "rgba(121, 180, 115,.1)",
  "rgba(56, 114, 108,.1)",
  "rgba(118, 190, 208,.1)")

faulkner_colorway_bw = c("#999999", "#777777",	"#555555", "#333333",	
"#111111")

#This controls the background color for the entire chart. Probably best left white.
faulkner_paperbackground = c('rgba(255,255,255,0)')

#This controls the background for the plot. Probably best left white.
faulkner_plotcolor = c('rgba(255,255,255,.3)')

#Margin 

m <- list(l = 50, r = 50, b = 50, t = 50, pad = 4)

#Caption Style

fig_caption <- "font-family: 'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif; font-weight: normal; font-size:90%"

plot_font <- list(family = "'Playfair Display','Helvetica Neue',Helvetica,Arial,sans-serif",
  size = 12,
  color = '#363636')
```


```{r}
library(knitr)
library(shiny)
library(tidyverse)
library(plotly)
library(cooccur)
```



```{r}
dy_events <- read_csv("data/full_database_2021_5_11.csv")

dy_events <-  dy_events %>% 
   mutate(reduced_race = ifelse(Race != "White" & Race != "Black" & Race != "Unknown", "Multiple Ancestries", Race)) %>% 
   mutate(reduced_race = ifelse(Race == "Indian", "Native American", reduced_race))
              

```

```{r}
space <- read_csv("location_spaces.csv")
```


```{r dy_characters}

dy_raw_characters <- dy_events %>% 
    distinct (SourceTextCode, CharacterName, reduced_race) %>% 
              count(reduced_race) %>% 
              mutate(percent = n/sum(n))

```



```{r character_count}

dy_events_characters <- dy_events %>% 
                        filter(PresentMentioned=="Present") %>% 
                        filter(IndividualGroup =="Individual") %>% 
                        count(reduced_race) %>% 
                         mutate(percent = n/sum(n))
```


```{r}

total <-  dy_events %>% 
                        filter(PresentMentioned=="Present") %>% 
                        filter(IndividualGroup =="Individual") %>% 
                        filter(Gender != "Multi Gender Group") %>% 
                        count(CharacterName, "values") %>% 
                        summarise(values =sum(n)) %>% 
                        mutate(labels = "Total", .before=1) 
                        

races <- dy_events %>% 
                        filter(PresentMentioned=="Present") %>% 
                        filter(IndividualGroup =="Individual") %>% 
                        filter(Gender != "Multi Gender Group") %>% 
                        count(reduced_race, name = "values") %>% 
                        rename(labels = reduced_race) %>% 
                        mutate(parents= total$labels) %>% 
                        mutate(ids = paste(parents, " - ", labels, sep= "")) 

genders <- dy_events %>% 
                        filter(PresentMentioned=="Present") %>% 
                        filter(IndividualGroup =="Individual") %>% 
                        filter(Gender != "Multi Gender Group") %>% 
                        group_by(Gender) %>% 
                        count(reduced_race, name = "values") %>% 
                        rename(labels = Gender) %>% 
                        arrange(labels) %>% 
                        mutate(parents = paste(total$labels, " - ", reduced_race, sep ="")) %>% 
                        mutate(ids = paste(parents, " - ", labels, sep= "")) %>% 
                        ungroup() %>% 
  group_by(parents) %>% 
   arrange(desc(values), .by_group = TRUE) %>% 
                        select(-reduced_race)
              
                       

characters <- dy_events %>% 
  filter(PresentMentioned == "Present") %>%
  filter(IndividualGroup == "Individual") %>%
  filter(Gender != "Multi Gender Group") %>%
  group_by(reduced_race, Gender) %>%
  count(CharacterName, name = "values") %>%
  top_n(10) %>%
  rename(labels = CharacterName) %>%
  mutate(parents = paste("Total - ", reduced_race, " - ", Gender, sep =
                           "")) %>%
  mutate(ids = paste(parents, " - ", labels, sep = ""))  %>%
  ungroup() %>%
  select(labels:ids) %>% 
  group_by(parents) %>% 
   arrange(desc(values), .by_group = TRUE)
  
sunburst <- total %>% 
            bind_rows(races) %>% 
            bind_rows(genders) %>% 
            bind_rows(characters)

```

```{r}


demography_sunburst <- 
                         plot_ly(
  labels = sunburst$labels,
  parents = sunburst$parents,
    values = sunburst$values,
  ids = sunburst$ids,
  type = 'sunburst',
    hovertemplate = paste(round((sunburst$values/total$values[1])*100,0), "% Present",
    "<extra>Total appearances: ",sunburst$values,"</extra>", sep=""),
  branchvalues = 'total'
  
)

demography_sunburst <- demography_sunburst %>% 
 add_annotations(
  x = 0,
  y = 1,
  xref = 'paper',
  yref = 'paper',
  showarrow = FALSE,
  text = c("Click on the pie pieces to view individual charts"),
  font = list(size = 10)
)

demography_sunburst <- demography_sunburst %>% 
    layout(
    title = "Character Presence in all Events",
    showlegend = FALSE,
    colorway = c("#132C53","#ae0700","#F27A18","#79b473","#38726c","#76bed0","#6b2d5c","#448b2d","#e6d812"),
    #The colorway had to be reversed to account for Plotly taking the higher value to match the colorway.
    font = plot_font,
    margin = m,
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    modebar = list(bgcolor= faulkner_paperbackground)
  )


div(demography_sunburst,align = "center")
```

```{r}
location_data <- read_csv("data/locations.csv")  
event_types <- read_csv("data/events.csv")
```
```{r}
location_type <- location_data %>% 
                  mutate(LocationCode = paste(SourceTextCode,LocationKey, sep="")) %>% 
                  select(LocationCode, Type)
event_locations <- event_types %>% 
                  mutate(LocationCode = as.numeric(LocationCode)) %>% 
                  mutate(LocationCode = paste(SourceTextCode,LocationCode, sep="")) %>% 
              select(c(Nid, LocationCode) )

event_location_types <- event_locations %>% 
                        left_join(location_type) %>% 
                        rename(EventID = Nid) 
                        
```

```{r}
location_export <- location_type %>% 
                    distinct(Type)

write_csv(location_export, "location_export.csv")
```


```{r}
dy_classes <- dy_events %>% 
              distinct(Class)
```

```{r}
co_occurrence_matrix <- dy_events %>% 
  filter(PresentMentioned == "Present") %>%
  filter(IndividualGroup == "Individual") %>%
  filter(Gender != "Multi Gender Group") %>%
    select(EventID, reduced_race, Gender, Class) %>% 
    mutate (Class = ifelse(Class == "Indian Chief", "Indian_Tribal_Leader", Class)) %>% 
      mutate(Class = ifelse(Class == "Yeoman", "Middle Class",Class)) %>%
      mutate(Class = ifelse(Class == "Enslaved Black", "Enslaved", Class)) %>% 
      mutate(Class = ifelse(Class == "Free Black", "Free", Class)) %>% 
      mutate(Class = ifelse (reduced_race == "Black" & Class !="Enslaved","Free", Class)) %>% 
    mutate (race_gender_class = paste(reduced_race,Gender, Class, sep = "_"))  %>% 
 select(!(reduced_race:Class))  %>%
  group_by(EventID) %>%
  count(race_gender_class) %>% 
  mutate(n = ifelse (n > 0, 1, 0)) %>% 
  pivot_wider(names_from = EventID,
              values_from = n,
              values_fill = 0)  %>% 
  column_to_rownames(var = "race_gender_class")
  

```

```{r, cache=TRUE}
race_class_gender_cooccur <-
  cooccur(
    mat = co_occurrence_matrix,
    type = "spp_site",
    thresh = FALSE,
    spp_names = TRUE,
    true_rand_classifier = 0.1,
    prob = "comb",
    site_mask = NULL,
    only_effects = FALSE,
    eff_standard = FALSE,
    eff_matrix = FALSE
  )


```
```{r}
#plot(race_class_gender_cooccur)

```


```{r}

cooccur_table <- prob.table(race_class_gender_cooccur)

#pair_table <- pair.attributes(race_class_gender_cooccur)
#pair.profile(race_class_gender_cooccur)
```



```{r}
place_matrix <- dy_events %>% 
  filter(PresentMentioned == "Present") %>%
  filter(IndividualGroup == "Individual") %>%
  filter(Gender != "Multi Gender Group") %>%
    select(EventID, reduced_race, Gender, Class) %>% 
    mutate (Class = ifelse(Class == "Indian Chief", "Indian_Tribal_Leader", Class)) %>% 
      mutate(Class = ifelse(Class == "Yeoman", "Middle Class",Class)) %>% 
    mutate (race_gender_class = paste(reduced_race,Gender, Class, sep = "_")) %>% 
  group_by(EventID) %>% 
  add_count(EventID) %>%   
  filter(n==2) %>% 
  mutate(n = 1) %>% 
   pivot_wider(names_from = race_gender_class, values_from = n, values_fill = 0, values_fn = sum)  %>% 
  select(!(reduced_race:Class))  
  #group_by(EventID) %>% 
  #summarise(across(is.numeric, ~ sum(.x))) 
  
place_characters <- place_matrix %>% 
                    pivot_longer(2:9) %>% 
                    filter(value>0) %>% 
                    group_by(EventID) %>% 
                    arrange(name, .by_group = TRUE) %>% 
                    mutate(intersection = ifelse(value<2,paste0(name, collapse = "."),paste(name,name, sep = ".")))  %>% 
                  left_join(event_location_types)  %>% 
                  group_by(Type) %>% 
                      count(intersection) %>% 
                    pivot_wider(names_from = Type, values_from = n,values_fill = 0)
  
  
                 


```

```{r}
race_gender_matrix <- dy_events %>% 
  filter(PresentMentioned == "Present") %>%
  filter(IndividualGroup == "Individual") %>%
  filter(Gender != "Multi Gender Group") %>%
    select(EventID, reduced_race, Gender) %>% 
    mutate (race_gender = paste(reduced_race,Gender, sep = "_")) %>% 
  group_by(EventID) %>% 
  add_count(EventID) %>%   
  filter(n==2) %>% 
  mutate(n = 1) %>% 
   pivot_wider(names_from = race_gender, values_from = n, values_fill = 0, values_fn = sum)  %>% 
  select(!(reduced_race:Gender)) %>% 
  pivot_longer(2:9) %>% 
                    filter(value>0) %>% 
                    group_by(EventID) %>% 
                    arrange(name, .by_group = TRUE) %>% 
                    mutate(intersection = ifelse(value<2,paste0(name, collapse = "."),paste(name,name, sep = "."))) %>% 
  ungroup() %>% 
  count(intersection)
  #group_by(EventID) %>% 
  #summarise(across(is.numeric, ~ sum(.x))) 
  
place_characters <- place_matrix %>% 
                    pivot_longer(2:9) %>% 
                    filter(value>0) %>% 
                    group_by(EventID) %>% 
                    arrange(name, .by_group = TRUE) %>% 
                    mutate(intersection = ifelse(value<2,paste0(name, collapse = "."),paste(name,name, sep = ".")))  %>% 
                  left_join(event_location_types)  %>% 
                  group_by(Type) %>% 
                      count(intersection) %>% 
                    pivot_wider(names_from = Type, values_from = n,values_fill = 0)
  
  
                 


```


```{r}
co_occurrence_locations <- dy_events %>% 
  filter(PresentMentioned == "Present") %>%
  filter(IndividualGroup == "Individual") %>%
  filter(Gender != "Multi Gender Group") %>%
    select(EventID, reduced_race, Gender, Class) %>% 
    mutate (Class = ifelse(Class == "Indian Chief", "Indian_Tribal_Leader", Class)) %>% 
      mutate(Class = ifelse(Class == "Yeoman", "Middle Class",Class)) %>%
      mutate(Class = ifelse(Class == "Enslaved Black", "Enslaved", Class)) %>% 
      mutate(Class = ifelse(Class == "Free Black", "Free", Class)) %>% 
      mutate(Class = ifelse (reduced_race == "Black" & Class !="Enslaved","Free", Class)) %>% 
    mutate (race_gender_class = paste(reduced_race,Gender, Class, sep = "_"))  %>% 
 select(!(reduced_race:Class))  %>%
  group_by(EventID) %>%
  count(race_gender_class) %>% 
  add_count(EventID, name ="event_nr") %>% 
  filter(event_nr>1) %>% 
  mutate(n = ifelse (n > 0, 1, 0)) %>% 
  group_by(EventID) %>% 
  summarise(out = list(combn(race_gender_class, 2, FUN = function(x)
     tibble(word1 = x[1], word2 = x[2]), simplify = FALSE))) %>%
  unnest %>%
  unnest %>% 
  mutate(intersection = paste(word1,word2, sep = ".")) %>% 
  select(EventID,intersection)
```
```{r}
co_occurrence_types <- co_occurrence_locations %>% 
                  left_join(event_location_types) %>% 
                            group_by(Type) %>% 
                      count(intersection) %>% 
                    pivot_wider(names_from = Type, values_from = n,values_fill = 0) %>% 
                    select(-"NA")
```
```{r}
tagged_prob_table <- cooccur_table %>% 
                     mutate(relationship = case_when(
                       p_lt < .05 ~"Negative",
                       p_lt > .05 & p_lt <.95 ~"Random",
                       p_lt > .95 ~"Positive"
                     )) %>% 
                    arrange(sp1_name, sp2_name) %>% 
                    mutate(intersection = ifelse(sp1_name<sp2_name, paste(sp1_name, sp2_name, sep="."),paste(sp2_name, sp1_name, sep=".") ) )
```

```{r}
interaction_tags <- tagged_prob_table %>% 
                    select(relationship, intersection)
```

```{r}
tagged_types <- co_occurrence_types %>% 
                left_join(interaction_tags) %>% 
                relocate(relationship, .before = 1) 
        
```


```{r}
library(plotly)
library(stats)

hover_data <- tagged_types %>%
              mutate(intersection = str_replace_all(intersection, "_", " ")) %>% 
              separate(intersection, c("character1", "character2"), "\\.") %>% 
              rowwise() %>% 
              mutate(total = sum(Cabin:YoknapatawphaInset) ) %>% 
              select(character1, character2, total)
              

X <- subset(tagged_types, select = -c(relationship:intersection))
prin_comp <- prcomp(X, rank = 2)
components <- prin_comp[["x"]]
components <- data.frame(components)
components <- cbind(components, co_occurrence_types$intersection)
components$PC2 <- -components$PC2
explained_variance <- summary(prin_comp)[["sdev"]]
explained_variance <- explained_variance[1:2]
comp <- prin_comp[["rotation"]]
comp[,'PC2'] <- - comp[,'PC2']
loadings <- comp
for (i in seq(explained_variance)){
  loadings[,i] <- comp[,i] * explained_variance[i]
}


features = tagged_types %>% 
           pivot_longer(3:14) %>% 
           distinct(name)

features = features$name

fig <-
  plot_ly(
    components,
    x = ~ PC1,
    y = ~ PC2,
    color = ~ tagged_types$relationship,
    colors = faulkner_colorway[2:6],
     hovertemplate = paste("Character 1:", hover_data$character1,"<br>Character 2:", hover_data$character2, "<extra>Total interactions:<br>",hover_data$total,"</extra>"),
    #hovertext = tagged_types$intersection,
    type = 'scatter',
    mode = 'markers'
  ) %>%
  layout(
    legend = list(title = list(text = 'Co-occurrence')),
    plot_bgcolor = faulkner_plotcolor,
    xaxis = list(title = "0"),
    yaxis = list(title = "1"),
    showlegend = TRUE
  )
for (i in seq(12)) {
  fig <- fig %>%
    add_segments(
      x = 0,
      xend = loadings[i, 1],
      y = 0,
      yend = loadings[i, 2],
      line = list(color = 'black'),
      inherit = FALSE,
      showlegend = FALSE
    ) %>%
    add_annotations(
      x = loadings[i, 1],
      y = loadings[i, 2],
      ax = 0,
      ay = 0,
      text = features[i],
      xanchor = 'center',
      yanchor = 'bottom'
    )
}

fig
```

```{r}
co_occurrence_simplified <- dy_events %>% 
  filter(PresentMentioned == "Present") %>%
  filter(IndividualGroup == "Individual") %>%
  filter(Gender != "Multi Gender Group") %>%
    select(EventID, reduced_race, Gender) %>% 
  filter(reduced_race == c("Black","White") ) %>% 
  mutate (race_gender = paste(reduced_race,Gender, sep = "_"))  %>% 
 select(!(reduced_race:Gender))  %>%
  group_by(EventID) %>%
  count(race_gender) %>% 
  add_count(EventID, name ="event_nr") %>% 
  filter(event_nr>1) %>% 
  mutate(n = ifelse (n > 0, 1, 0)) %>% 
  group_by(EventID) %>% 
  summarise(out = list(combn(race_gender, 2, FUN = function(x)
     tibble(word1 = x[1], word2 = x[2]), simplify = FALSE))) %>%
  unnest %>%
  unnest %>% 
  mutate(intersection = paste(word1,word2, sep = ".")) %>% 
  select(EventID,intersection) %>% 
  group_by(EventID) %>% 
  count(intersection)
  
```

```{r}
#get location information

dy_coordinates <- dy_events %>% 
                  mutate(X = ifelse(is.na(`True X`), X, `True X`)) %>% 
                  mutate(Y = ifelse(is.na(`True Y`), Y, `True Y`)) %>%
                  mutate(X = X - 632) %>% 
                  mutate(new_y = Y*-1) %>% 
                  select(EventID,X, Y, new_y, LocationTitle, LocationID) 
                    

co_occurrence_mapped <- co_occurrence_simplified %>% 
                        left_join(dy_coordinates) %>% 
                        left_join(event_location_types) %>% 
                        left_join(space) %>% 
                        select(-n)
                        
co_occurrence_xy <- co_occurrence_mapped %>% 
                    group_by(LocationTitle,intersection) %>% 
                    add_count(LocationTitle) %>% 
                    distinct(intersection, .keep_all=TRUE) %>% 
                    ungroup() %>% 
                    group_by(LocationTitle) %>% 
                    mutate(transformed_y = round(mean(Y),0)*-1) %>% 
                    mutate(transformed_x = round(mean(X),0)) %>%             
  select(!(LocationID:Type)) %>% 
                    group_by(Space) %>% 
                    arrange(desc(n), .by_group = TRUE)

co_occurence_race_groups <- co_occurrence_xy %>%
  separate(
    intersection,
    into = c("race1", "gender1", "race2", "gender2"),
    sep = "[_\\.]"
  ) %>%
  ungroup() %>%
  mutate(
    difference = case_when(
      race1 != race2 &
        gender1 != gender2 ~ "Different race<br>Different gender",
      race1 == race2 &
        gender1 != gender2 ~ "Same race<br>Different gender",
      race1 != race2 &
        gender1 == gender2 ~ "Different race<br>Same gender"
      )
  ) %>% 
  mutate (LocationTitle = ifelse(str_detect(LocationTitle,"Compson")==TRUE & Space == "Domestic", "Compson Place", LocationTitle)) %>% 
  group_by(LocationTitle) %>% 
  mutate(transformed_x = round(mean(transformed_x),0), transformed_y = round(mean(transformed_y),0)) %>% 
  group_by(difference,transformed_x,transformed_y,LocationTitle,Space) %>% 
  summarise(n = sum(n)) %>% 
  group_by(LocationTitle) %>% 
  arrange(difference,desc(n),.group_by=TRUE)
  

```

```{r out.width="768px",  out.height="605px"}
image_file <- "https://raw.githubusercontent.com/joostburgers/absalom_sentiment_analysis/master/images/dy_base_layer_4_2.png"

fig_cooccur_map <-
  plot_ly(
    co_occurrence_xy,
    x = ~ transformed_x,
    y = ~ transformed_y,
    frame = ~Space,
    name=~str_replace_all(intersection, c("_" = " ", "\\."= "<br>")),
    color=~intersection,
  #  colors = faulkner_colorway,
    type = 'scatter',
    mode = 'markers',
      size = ~n,
      fill = ~"",
     # sizes = c(1, 5),
      hoverinfo='text',
    text= ~paste('Count:', n,'<br>',LocationTitle),
     marker = list(
        sizemode='diameter',
        sizeref = 2, 
                  opacity = .4,
                  line = list(width = 1, color = 'white')
          ),
     width = 768,
      height = 605
   
  )
fig_cooccur_map <- fig_cooccur_map %>%
  layout(
    title = "Race and Gender Co-Occurrence by Location Type",
    xaxis = list(
      title = "",
      visible = FALSE,
      fixedrange = TRUE,
      range = c(0, 2008)
    ),
    yaxis = list(
      title = "",
      visible = FALSE,
      fixedrange = TRUE,
      range = c(-1660, 0)
    ),
    margin = m,
    font = plot_font,
    legend = list(
      title = list(text = "<b>Co-Occurrence Type</b>"),
      itemsizing = 'constant'
    ),
    autosize = F,
      
    images = list(
      list(
        source =  image_file,
        xref = "x",
        yref = "y",
        x = 0,
        y = -40,
        sizex = 2008,
        sizey = 1660,
         sizing = "stretch",
        opacity = 0.8,
        layer = "below"
      )
      )
  )

fig_cooccur_map <- fig_cooccur_map %>% animation_opts(
    1000, easing = "linear-out", redraw = FALSE
  )


fig_cooccur_map 
#tags$h6(HTML("<i>Figure 9:</i> Map of where each racial word appears in the text by location."), style =fig_caption)
#tags$br()
```


```{r}
image_file <- "https://raw.githubusercontent.com/joostburgers/absalom_sentiment_analysis/master/images/dy_base_layer_4_2.png"

fig_cooccur_map_groups <-
  plot_ly(
    co_occurence_race_groups,
    x = ~ transformed_x,
    y = ~ transformed_y,
    frame = ~Space,
    name=~difference,
    color=~difference,
    #colors = faulkner_colorway[c(1,3:4)],
    type = 'scatter',
    mode = 'markers',
      size = ~n,
      fill = ~"",
     # sizes = c(1, 5),
      hoverinfo='text',
    text= ~paste('Count:', n,'<br>',LocationTitle),
     marker = list(
        sizemode='diameter',
        sizeref = 2, 
                  opacity = .4,
                  line = list(width = 1, color = 'white')
          ),
     width = 768,
      height = 605
   
  )
fig_cooccur_map_groups <- fig_cooccur_map_groups %>%
  layout(
    title = "Race and Gender Co-Occurrence by Location Type",
    xaxis = list(
      title = "",
      visible = FALSE,
      fixedrange = TRUE,
      range = c(0, 2008)
    ),
    yaxis = list(
      title = "",
      visible = FALSE,
      fixedrange = TRUE,
      range = c(-1660, 0)
    ),
    margin = m,
    font = plot_font,
    legend = list(
      title = list(text = "<b>Co-Occurrence Type</b>"),
      itemsizing = 'constant'
    ),
    autosize = F,
      
    images = list(
      list(
        source =  image_file,
        xref = "x",
        yref = "y",
        x = 0,
        y = -40,
        sizex = 2008,
        sizey = 1660,
         sizing = "stretch",
        opacity = 0.8,
        layer = "below"
      )
      )
  )

fig_cooccur_map_groups <- fig_cooccur_map_groups %>% animation_opts(
    1000, easing = "circle-in-out", redraw = FALSE
  )


fig_cooccur_map_groups 
```



# Navigation

Right >

## Navigation

Down
V 

## Navigation

^
Up

# Navigation

< Left




# Overview

- Digital Humanities and Digital Yoknapatawpha
- Spatial Humanities and Literary GIS
- Digital Pedagogy
- Training the Next Digital Cartographer


# Digital Humanities (a primer) 

>“I believe this is a groundbreaking effort that will allow readers to experience the world of great literature in a technologically new and meaningful, lasting way.”

- Burgers, Johannes. ["Mapping Faulkner’s Fiction through Digital Space and Time"](https://www.qcc.cuny.edu/news/2016/09/Faulkner.html) 09/19/2016


# {data-background-iframe="http://faulkner.iath.virginia.edu/" data-background-interactive=TRUE}
          
          
          
# Spatial Humanities and Literary GIS



# Digital Pedagogy

# Training the Next Digital Cartographer


  <form action="#">
      Enter website: <input type="text" name="website" data-name="website"/><br/>
      <button type="submit">Submit</button>


<script>

    $(function() {
        $('body').on('submit','form',function() {
            var answers = [];
            $('input[type="text"]', this).each(function(){
            answers.push({'name':$(this).data('name'), 'value':this.value});
            });
            var data = {
                'answers': answers
            };
            json = JSON.stringify(data);
            $('#json').append(json);
            return false;
        });    
    });
    
</script>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script language = "JavaScript">

Reveal.addEventListener( 'slidechanged', function(event) {
  var iframeSlides = document.getElementsByClassName('present'); //gets all the section divs
  console.log("navigation clicked")
  console.log(iframeSlides)

                    if (iframeSlides[0].dataset.backgroundIframe){ //looks to see if they have a data-background-iframe element
                        console.log("slide visible")
                        console.log(iframeSlides[0].parentNode.style.zIndex = "-1"); //.style.display = 'none'  also failing style.visibility = 'hidden'; //if it does set the parent element to go to the back
                    }
                    else{
                      iframeSlides[0].parentNode.style.zIndex = "2"
                    }

///Could be cleaner but basically there.

                //Need to get current slide and seee if backgroundIframe is there and then check if it is visible.
});

</script>
